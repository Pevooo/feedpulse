"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[30879],{513091:function(t,e){e.y=function(t){return`/annabel/?subtaskId=${t}`}},172086:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.isPointInsidePolygon=function(t,e){const a=t.length;if(a<3)return!1;const o={x:1e9,y:e.y};let s=0,h=0;for(;;){const l=(h+1)%a;if(r(t[h],t[l],e,o)){if(0===i(t[h],e,t[l]))return n(t[h],e,t[l]);s+=1}if(h=l,0===h)break}return s%2===1};function n(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function i(t,e,n){const i=(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y);return 0===i?0:i>0?1:2}function r(t,e,r,a){const o=i(t,e,r),s=i(t,e,a),h=i(r,a,t),l=i(r,a,e);return o!==s&&h!==l||(!(0!==o||!n(t,r,e))||(!(0!==s||!n(t,a,e))||(!(0!==h||!n(r,t,a))||!(0!==l||!n(r,e,a)))))}},412636:function(t,e,n){e.SW=e.D0=void 0;var i,r=(i=n(298784))&&i.__esModule?i:{default:i},a=n(845851),o=n(130850),s=n(692600),h=n(169186),l=n(971599),f=n(167469);const u={[f.TaskType.Transcription]:a.lintTranscription,[f.TaskType.SegmentAnnotation]:o.lintSegmentAnnotation,[f.TaskType.VideoAnnotation]:s.lintVideoAnnotation,[f.TaskType.VideoBoxAnnotation]:s.lintVideoAnnotation,[f.TaskType.VideoCuboidAnnotation]:s.lintVideoAnnotation,[f.TaskType.VideoPolygonAnnotation]:s.lintVideoAnnotation,[f.TaskType.ImageAnnotation]:h.lintImageAnnotation},c=[f.TaskType.SegmentAnnotation,f.TaskType.TextCollection,f.TaskType.NamedEntityRecognition];e.D0=t=>!c.includes(t);e.SW=(t,e,n=l.LintSeverity.INFO)=>{const i=r.default.get(u,t,(()=>[])),a=[l.LintSeverity.ERROR];n===l.LintSeverity.WARNING?a.push(l.LintSeverity.WARNING):n===l.LintSeverity.INFO&&(a.push(l.LintSeverity.WARNING),a.push(l.LintSeverity.INFO));const o=i(e);return r.default.filter(o,(t=>r.default.includes(a,t.severity)))}},339271:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.dataQualityLinters=void 0;var i,r=(i=n(298784))&&i.__esModule?i:{default:i},a=n(971599),o=n(599789),s=n(935866),h=n(101241);const l=(t,e)=>{const n=[o.ReviewLevel.Attempt],i=[];if(!n.includes(e))return i;const l=t.annotations;return r.default.forEach(l,(t=>{if(s.isPolygonAnnotation(t)){const e=t;i.push(...((t,e)=>{const n=[];if(t.vertices.length<3){const t=new a.LintDiagnostic(e,a.LintSeverity.DISMISSABLE_ERROR,{message:`Annotation [${e}] must have at least 3 points in its polygon)`,type:h.DataQualityLinterEnum.NO_POLYGON_WITH_LESS_THAN_THREE_POINTS});n.push(t)}return n})(e,t.uuid)),i.push(...((t,e)=>{const n=[],i=new Set;return r.default.forEach(t.vertices,(t=>{if(i.has(t)){const i=new a.LintDiagnostic(e,a.LintSeverity.DISMISSABLE_ERROR,{message:`Annotation [${e}] cannot have duplicated point (${t.x}, ${t.y})`,type:h.DataQualityLinterEnum.NO_DUPLICATE_POINTS});n.push(i)}else i.add(t)})),n})(e,t.uuid))}})),i};e.dataQualityLinters=(t,e)=>{const n=[];return n.push(...l(t,e)),n}},408412:function(t,e){function n(t){return t&&t.type&&t.params?.labels}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){const i=(t.trainingScenario?.params?.trainingLinters||[]).filter(n).find((t=>t.type===e));if(i&&function(t,e){return t.type===e}(i,e))return i}},935866:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.getFinalPolygonArea=e.getPolygonArea=e.getPolygonsMap=e.getNodesMap=e.isPolygonAnnotation=void 0;var i,r=n(440169),a=n(172086),o=n(308408),s=(i=n(298784))&&i.__esModule?i:{default:i};e.isPolygonAnnotation=t=>!(!t.geometry||t.geometry!==o.AnnotationGeometry.Polygon)||!(!t.type||t.type!==o.AnnotationGeometry.Polygon);e.getNodesMap=(t,e,n)=>{const i={[t]:n[t],[e]:n[e]};let r=!0;const a=new Set(s.default.keys(i));for(;r;){r=!1;const t=s.default.flattenDeep(s.default.values(i)).filter((t=>!a.has(t)));s.default.forEach(t,(t=>{t&&!i[t]&&(i[t]=n[t]||[],r=!0),a.add(t)}))}return i};e.getPolygonsMap=(t,e)=>{const n=Array.from(new Set(s.default.flattenDeep([s.default.entries(t)]))),i={};return s.default.forEach(n,(t=>{i[t]=e.find((e=>e.uuid===t))??{}})),i};e.getPolygonArea=t=>r.polygonFor(t).getArea();e.getFinalPolygonArea=t=>{let e=0;const n=s.default.flattenDeep([...t].map((t=>t.vertices))),i=s.default.minBy(n,(t=>t.x)),r=s.default.minBy(n,(t=>t.y)),o=s.default.maxBy(n,(t=>t.x)),h=s.default.maxBy(n,(t=>t.y));let l=null;for(const f of s.default.range(i.x,o.x))for(const n of s.default.range(r.y,h.y)){const i={x:f,y:n};if(l){if(a.isPointInsidePolygon(l.vertices,i)){e++;continue}l=null}const r=t.find((t=>a.isPointInsidePolygon(t.vertices,i)));r&&(e++,l=r)}return e}},169186:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.lintImageAnnotation=void 0;var i,r=n(599789),a=(i=n(298784))&&i.__esModule?i:{default:i},o=n(722715),s=n(101241),h=n(339271);const l=["62c2c8453447790033a739c6","61a7c74850120a002cafe687"];e.lintImageAnnotation=t=>{const e=t.response,n=t.metadata;if(!n)return[];const i=n.reviewLevel??r.ReviewLevel.Attempt,f=t.runningFrontend,u=a.default.isString(n.projectId)?n.projectId:a.default.isNil(n.projectId)?null:n.projectId.toString(),c=[];return f&&u&&l.includes(u)&&c.push(...((t,e,n=[])=>{const i=n.find((t=>{if(t?.condition?.scriptName!==s.ScriptLinterName.VisibleMask)return!1;if(t.stage===s.LintStage.Backend)return!1;switch(e){case r.ReviewLevel.Attempt:return t.enableAttempt;case r.ReviewLevel.Normal:return t.enableL0;case r.ReviewLevel.Level1:return t.enableL1;case r.ReviewLevel.Corp:return t.enableL10;case r.ReviewLevel.CorpFlagged:return t.enableL11;case r.ReviewLevel.Deliverable:return t.enableL12;default:return!1}}));if(!i)return[];const a={linkLabel:"Object Occlusion Links",labels:["Bin","Human","Robot","Hole","Object","Compartment Wall","Occluded Part"],coveredThreshold:.98},h=i.message,l=i.frontendSeverity,f=i?.condition?.config??a;return o.executeVisibleMaskLinter(t,f,h,l)})(e,i,n.responseLintersRules)),f&&u&&c.push(...h.dataQualityLinters(e,i)),c}},130850:function(t,e,n){n(830816).Buffer;Object.defineProperty(e,"__esModule",{value:!0}),e.lintSegmentAnnotation=void 0;var i=s(n(298784)),r=n(971599),a=(n(139788),n(135277)),o=s(n(408412));s(n(210918));function s(t){return t&&t.__esModule?t:{default:t}}const{ERROR:h,WARNING:l}=r.LintSeverity;new Set(["5e87f33bfd31cb002b0c970b","5f90b3c28d9edd0024ab06ba","5f455ae5fba2cf0025af74d0","5e56774c5e3cbb0017dbbb49","5fd9b5bac16483003328590b","6066178d75cc250017e06fb7","5eeac6d8e0617300c55d48e1","5f4d4b1f338f3e00250019c5"]);e.lintSegmentAnnotation=t=>{const{task:e,subtask:n,response:s,featureFlaggedLinters:l,fromMadeChanges:f=!1}=t,u=[];return f||(u.push(...(({task:t,subtask:e,response:n,featureFlaggedLinters:s})=>{const l=[],f=s?.["opacity-workflow-linter"],u=o.default(t,a.TrainingLinterType.CheckOpacityWorkflow);if(!f||!u)return l;const c=u.params.labels.length>0,p=c?i.default.pick(n.labelMapping,u.params.labels):n.labelMapping,d=i.default.flatten(i.default.values(p));if(c){if(i.default.every(d,(t=>t.hasAdjustedOpacity)))return l;const t=i.default.findKey(p,(t=>Array.isArray(t)?i.default.find(t,(t=>!t.hasAdjustedOpacity)):!t.hasAdjustedOpacity));l.push(new r.LintDiagnostic("opacity-workflow",h,{message:`Be sure to adjust the opacity when reviewing every ${t||"labeled"} annotation to check for edge precission errors (shortcut is the '<' and '>' keys).`}))}else i.default.some(d,(t=>t.hasAdjustedOpacity))||l.push(new r.LintDiagnostic("opacity-workflow",h,{message:"Be sure to adjust the opacity to get a clear view when checking label edges by using the '<' or '>' keys."}));return l})({task:e,subtask:n,response:s,featureFlaggedLinters:l})),u.push(...(({task:t,subtask:e,response:n,featureFlaggedLinters:a})=>{const o=[],s=a?.["outline-workflow-linter"];if(!s)return o;const l=n.labelMapping,f=i.default.pickBy(l,(t=>t.numPixels>0&&!t.hasViewedWithOutlineTool)),u=i.default.keys(f);return i.default.isEmpty(u)||o.push(new r.LintDiagnostic("outline-workflow",h,{message:`You must use the outline tool to check for stray pixels on every label (use the 'o' key to enable) before submitting.\n Please use outline tool on the following labels: ${i.default.join(u)}`})),o})({task:e,subtask:n,response:s,featureFlaggedLinters:l})),u.push(...(({task:t,subtask:e,response:n,featureFlaggedLinters:s})=>{const l=[],f=s?.["checkmark-workflow-linter"],u=o.default(t,a.TrainingLinterType.CheckCheckmarkWorkflow);if(!f||!u)return l;const c=i.default.pick(n.labelMapping,u.params.labels),p=i.default.flatten(i.default.values(c));if(!i.default.every(p,(t=>t.hasReviewed))){const t=i.default.findKey(c,(t=>Array.isArray(t)?i.default.find(t,(t=>!t.hasReviewed)):!t.hasReviewed));l.push(new r.LintDiagnostic("checkmark-workflow",h,{message:`Please be sure to inspect every ${t?`instance of ${t}`:"label and instance"} in the sidebar and mark them all as reviewed using the checkmark (or by pressing the 'shift' and 'space' keys at the same time).`}))}return l})({task:e,subtask:n,response:s,featureFlaggedLinters:l}))),u}},845851:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.lintTranscription=void 0;var i,r=(i=n(298784))&&i.__esModule?i:{default:i},a=n(971599);const{ERROR:o}=a.LintSeverity,s="5b1059fea2a93f002e8e0b76";e.lintTranscription=({task:t,response:e})=>{const n=[];return n.push(...(({task:t,response:e})=>t.user?.toString()!==s?[]:r.default.get(e,"repeatable_fields",[]).length>3?[new a.LintDiagnostic("too-many-categories",o,{message:"You labeled more than three room labels. Please only select up to three room labels."})]:[])({task:t,response:e})),n.push(...(({task:t,response:e})=>{if(t.user?.toString()!==s)return[];const n=[];let i=!1;for(const a of r.default.get(e,"repeatable_fields",[])){const t=r.default.get(a,"title",[]);n.includes(t)&&(i=!0),n.push(t)}return i?[new a.LintDiagnostic("category-label-repeat",o,{message:"You repeated the same room category label. Please use each room category label once."})]:[]})({task:t,response:e})),n}},692600:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.lintVideoAnnotation=void 0;var i,r=n(971599),a=(i=n(210918))&&i.__esModule?i:{default:i};const{ERROR:o}=r.LintSeverity,s=[a.default.Narwhal],h=t=>{if(t.paths)return t.paths[0]?.frames?new Set(t.paths.filter((t=>t.frames.filter((t=>!!t)).length)).map((t=>t.annotationId||t.uuid))):new Set(t.paths.filter((t=>t.props?.perFrame?.edges?.length||t.props?.perFrame?.x?.length||t.props?.perFrame?.vertices?.length||t.props?.perFrame?.width?.length)).map((t=>t.annotationId||t.uuid)));if(t.annotations){const e=t.annotations;if(!e.length)return null;const n=new Set;for(const{annotations:t}of e)if(t?.length)for(const e of t)e.uuid&&n.add(e.uuid);return n}return null};e.lintVideoAnnotation=t=>{const{subtask:e,response:n,reviewedAnnotations:i,featureFlaggedLinters:a,fromMadeChanges:l=!1}=t,f=[];return l||f.push(...(({reviewedAnnotations:t,response:e,subtask:n,featureFlaggedLinters:i})=>{const a=[],h=i?.["checkmark-workflow-linter"];return h?(h&&s.includes(n?.user)&&e.paths.length>t.paths.length&&a.push(new r.LintDiagnostic("checkmark-workflow",o,{message:"Every annotation must be looked at and marked as Done (using the checkmark tool) before submitting this task."})),a):a})({subtask:e,reviewedAnnotations:i,response:n,featureFlaggedLinters:a,fromMadeChanges:l})),!1===e.params?.can_delete_base_annotations&&f.push(...(({response:t,subtask:e})=>{const n=[];if(!e.params?.base_annotations)return n;if(e.params?.can_edit_base_annotations&&!1!==e.params?.can_delete_base_annotations)return n;const i=h(e.params.base_annotations);if(null===i)return n;const a=t?h(t):new Set;if(null===a)return n;for(const s of i)a.has(s)||n.push(new r.LintDiagnostic("base-annotations",o,{message:`Response is missing an annotation from the base annotations (uuid ${s}).`}));return n})({subtask:e,response:n})),f}},722715:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.executeVisibleMaskLinter=void 0;var i,r=(i=n(298784))&&i.__esModule?i:{default:i},a=n(808704),o=n(971599),s=n(10814),h=n(935866);const l=.98;e.executeVisibleMaskLinter=(t,e,n="There is a missing visible mask in the image. Please check links.",i=o.LintSeverity.WARNING)=>{const{linkLabel:f,labels:u,coveredThreshold:c=l}=e,p=t.annotations,d=t.links.filter((t=>t.label===f)),_=p.filter((t=>h.isPolygonAnnotation(t)&&u.includes(t.label))),g=_.map((t=>t.uuid)),y={};r.default.forEach(d,(t=>{g.includes(t.from)&&g.includes(t.to)&&(y[t.from]||(y[t.from]=[]),y[t.from].push(t.to))}));const m=[];let v=0;for(;v<2;){v++;const t={},e={},l={},f=()=>{const n=r.default.keys(y).filter((t=>!m.includes(t)));for(const i of n){if(t[i])continue;const n=[i];for(;n.length;){const i=n[n.length-1];if(t[i])e[i]=!1,n.splice(n.length-1);else{t[i]=!0,e[i]=!0;for(const r of y[i]??[])if(t[r]){if(e[r])return{startNode:r,endNode:i}}else n.push(r),l[r]=i}}}return{}},{startNode:u,endNode:p}=f();if(!u||!p)break;const d=h.getNodesMap(u,p,y),g=h.getPolygonsMap(d,_),b={},w=[];if(r.default.forEach(d,((t,e)=>{if(!t.length)return void(b[e]=h.getPolygonArea(g[e]));const{path:n}=s._subtractOverlappingAreas(g[e],t.map((t=>g[t])));r.default.isNil(n)?w.push(a.getFriendlyAnnotationId(e)):b[e]=h.getPolygonArea(n)})),!r.default.isEmpty(w))return[new o.LintDiagnostic("visible-mask",i,{message:n,taskComponentAnnotations:[{id:u,display:`Not visible area for annotations ${w.join(", ")}`}]})];const k=r.default.flattenDeep(r.default.keys(d).map((t=>g[t]))),T=h.getFinalPolygonArea(k);if(r.default.sum(r.default.values(b))/T<c)return[new o.LintDiagnostic("visible-mask",i,{message:n,taskComponentAnnotations:[{id:u,display:`Unexpected cyclical linking between annotations ${[u,p].map((t=>a.getFriendlyAnnotationId(t))).join(" - ")}`}]})];m.push(...r.default.keys(d))}return[]}},575904:function(t,e){var n;e.mp=e.cL=void 0,e.cL=n,function(t){t.Pending="Awaiting Review",t.Accepted="Accepted",t.Rejected="Rejected"}(n||(e.cL=n={}));e.mp=t=>!t.disabled},351818:function(t,e){var n,i;e.We=e.vw=void 0,e.vw=n,function(t){t.WorkerTeamPrimary="WorkerTeamPrimary",t.WorkerTeamSecondary="WorkerTeamSecondary",t.AssignedProjectLayers="AssignedProjectLayers",t.TieredBursty="TieredBursty",t.TieredPrimary="TieredPrimary",t.TieredSecondary="TieredSecondary",t.TieredTertiary="TieredTertiary"}(n||(e.vw=n={})),e.We=i,function(t){t.Info="info",t.Alert="alert",t.Warning="warning"}(i||(e.We=i={}))},135277:function(t,e){var n,i;Object.defineProperty(e,"__esModule",{value:!0}),e.TrainingLinterType=e.TutorialStep=void 0,e.TutorialStep=n,function(t){t.SelectAnnotation="select_annotation",t.Shortcut="lidar_shortcut",t.LidarFeature="lidar_feature",t.LoadComplete="load_complete",t.Text="text"}(n||(e.TutorialStep=n={})),e.TrainingLinterType=i,function(t){t.CheckCheckmarkWorkflow="CheckCheckmarkWorkflow",t.CheckOpacityWorkflow="CheckOpacityWorkflow"}(i||(e.TrainingLinterType=i={}))},10814:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e._subtractOverlappingAreas=function(t,e,n=!1){const i=r.default.cloneDeep(t);for(const r of e){if(r.fake)continue;const e=h(i,r,n);if(!e)return{success:e,path:t}}if(r.default.isEmpty(i.vertices))return{success:!0,path:t};return{success:!0,path:i}},e._subtractOverlappingAreasFromOthers=function(t,e,n=!1){const i=r.default.cloneDeep(e);for(const r of i){const i=h(r,t,n);if(!i)return{success:i,otherPaths:e}}return{success:!0,otherPaths:i.filter((t=>!r.default.isEmpty(t.vertices)))}},e.checkSelfIntersections=function(t,e){if(e.length<3||t.length<0)return!1;const n=e.map((t=>new a.geom.Coordinate(t.x,t.y))),i=t.map((t=>new a.geom.Coordinate(t.x,t.y)));for(const o of i){const t=a.geometryFactory.createLineString(n.slice(0,-1));if(a.geometryFactory.createLineString([o,r.default.last(n)]).intersects(t))return!0;n.push(o)}return!1},e.checkSelfIntersection=function(t,e){if(e.length<3)return!1;const n=r.default.map(e.slice(0,e.length-1),(t=>new a.geom.Coordinate(t.x,t.y))),i=a.geometryFactory.createLineString(n);return a.geometryFactory.createLineString([new a.geom.Coordinate(t.x,t.y),new a.geom.Coordinate(e[e.length-1].x,e[e.length-1].y)]).intersects(i)},e.doPathsOverlap=e.pointsToSVG=e.isClockwise=e.getDistance=e.getCenter=void 0;var i,r=(i=n(298784))&&i.__esModule?i:{default:i},a=n(440169),o=n(311311);function s(t,e,n){const i=[];return e.forEach((e=>{const o=function(t,e,n){let i=[t];const[o,...h]=e;if(o)return i=function(t,e,n){if(t.length<3)return null;if(e.length<3)return[t];const i=a.polygonFor({vertices:t}),o=a.polygonFor({vertices:e});try{const a=i.difference(o),s=r.default.map(r.default.range(a.getNumGeometries()),(t=>a.getGeometryN(t)));if(i.covers(o))return[f(t,e)];if(!n)return[r.default.maxBy(s,(t=>t.getArea())).getCoordinates().slice(1).map((({x:t,y:e})=>({x:t,y:e})))];const h=[];return s.forEach((t=>{h.push(t.getCoordinates().slice(1).map((({x:t,y:e})=>({x:t,y:e}))))})),h}catch(s){return null}}(t,o,n),r.default.isNil(i)?null:s(h,i,n);return i}(e,t,n);if(r.default.isNil(o))return null;i.push(...o)})),i}function h(t,e,n){const i=s(o.splitPointsByFragment(e.vertices,e.multiple_polygon_vertices),o.splitPointsByFragment(t.vertices,t.multiple_polygon_vertices),n);if(r.default.isNil(i))return!1;let a=[];r.default.each(i,(t=>{t&&a?.push({vertices:t})}));const h=r.default.reduce(a,((t,e)=>[...t,...e.vertices]),[]);return a.length<=1&&(a=void 0),t.vertices=h,a&&(t.multiple_polygon_vertices=a),!0}e.getCenter=(t=[])=>{const e=r.default.min(t.map((t=>t.x)))||0,n=r.default.min(t.map((t=>t.y)))||0;return{x:(e+(r.default.max(t.map((t=>t.x)))||0))/2,y:(n+(r.default.max(t.map((t=>t.y)))||0))/2}};const l=(t,e)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));e.getDistance=l;e.isClockwise=t=>r.default.sum(r.default.zipWith(t,t.slice(1).concat(t[0]),(({x:t,y:e},{x:n,y:i})=>(e+i)*(t-n))))<0;e.pointsToSVG=t=>r.default.map(t,(({x:t,y:e})=>`${t},${e}`)).join(" ");function f(t,e){if(t.length<3||e.length<3)throw new Error("Polygon must have at least 3 vertices");const n=a.polygonFor({vertices:t}),i=a.polygonFor({vertices:e});if(!n.covers(i))throw new Error("Polygon does not cover other polygon");let r,o,s=Number.MAX_VALUE;if(t.forEach((t=>{e.forEach((e=>{const n=l(t,e);n<s&&(s=n,r=t,o=e)}))})),!r||!o)throw new Error("Could not find closest pair of points");const h=[...t.slice(t.indexOf(r)),...t.slice(0,t.indexOf(r))],f=[...e.slice(e.indexOf(o)+1),...e.slice(0,e.indexOf(o)+1)],c=1e-5,p=function(t,e){const n={x:e.x-t.x,y:e.y-t.y},i={x:-n.y,y:n.x},r=Math.sqrt(i.x**2+i.y**2);return{x:i.x/r,y:i.y/r}}(r,o),d=u(r,p,c),_=u(o,p,c),g=u(r,p,-c),y=u(o,p,-c),m=[...h,d,_,...f];if(a.polygonFor({vertices:m}).isSimple())return m;const v=[...h,g,y,...f];if(a.polygonFor({vertices:v}).isSimple())return v;f.reverse();const b=[...f.slice(f.indexOf(o)+1),...f.slice(0,f.indexOf(o)+1)],w=[...h,d,_,...b];if(a.polygonFor({vertices:w}).isSimple())return w;return[...h,g,y,...b]}function u(t,e,n=0){return{x:t.x+e.x*n,y:t.y+e.y*n}}e.doPathsOverlap=(t,e)=>{const n=o.splitPointsByFragment(t.vertices,t.multiple_polygon_vertices),i=o.splitPointsByFragment(e.vertices,e.multiple_polygon_vertices),s=r.default.map(n,(t=>a.polygonFor({vertices:t}))),h=r.default.map(i,(t=>a.polygonFor({vertices:t})));return r.default.some(s,(t=>r.default.some(h,(e=>t.intersects(e)))))}},610648:function(t,e,n){var i=n(830816).Buffer,r=n(452364),a=[function(){},function(t,e,n,i){if(i===e.length)throw new Error("Ran out of data");var r=e[i];t[n]=r,t[n+1]=r,t[n+2]=r,t[n+3]=255},function(t,e,n,i){if(i+1>=e.length)throw new Error("Ran out of data");var r=e[i];t[n]=r,t[n+1]=r,t[n+2]=r,t[n+3]=e[i+1]},function(t,e,n,i){if(i+2>=e.length)throw new Error("Ran out of data");t[n]=e[i],t[n+1]=e[i+1],t[n+2]=e[i+2],t[n+3]=255},function(t,e,n,i){if(i+3>=e.length)throw new Error("Ran out of data");t[n]=e[i],t[n+1]=e[i+1],t[n+2]=e[i+2],t[n+3]=e[i+3]}],o=[function(){},function(t,e,n,i){var r=e[0];t[n]=r,t[n+1]=r,t[n+2]=r,t[n+3]=i},function(t,e,n){var i=e[0];t[n]=i,t[n+1]=i,t[n+2]=i,t[n+3]=e[1]},function(t,e,n,i){t[n]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=i},function(t,e,n){t[n]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3]}];function s(t,e,n,i,r,o){for(var s=t.width,h=t.height,l=t.index,f=0;f<h;f++)for(var u=0;u<s;u++){var c=n(u,f,l);a[i](e,r,c,o),o+=i}return o}function h(t,e,n,i,r,a){for(var s=t.width,h=t.height,l=t.index,f=0;f<h;f++){for(var u=0;u<s;u++){var c=r.get(i),p=n(u,f,l);o[i](e,c,p,a)}r.resetAfterLine()}}e.dataToBitMap=function(t,e){var n,a=e.width,o=e.height,l=e.depth,f=e.bpp,u=e.interlace;if(8!==l)var c=function(t,e){var n=[],i=0;function r(){if(i===t.length)throw new Error("Ran out of data");var r,a,o,s,h,l,f,u,c=t[i];switch(i++,e){default:throw new Error("unrecognised depth");case 16:f=t[i],i++,n.push((c<<8)+f);break;case 4:f=15&c,u=c>>4,n.push(u,f);break;case 2:h=3&c,l=c>>2&3,f=c>>4&3,u=c>>6&3,n.push(u,f,l,h);break;case 1:r=1&c,a=c>>1&1,o=c>>2&1,s=c>>3&1,h=c>>4&1,l=c>>5&1,f=c>>6&1,u=c>>7&1,n.push(u,f,l,h,s,o,a,r)}}return{get:function(t){for(;n.length<t;)r();var e=n.slice(0,t);return n=n.slice(t),e},resetAfterLine:function(){n.length=0},end:function(){if(i!==t.length)throw new Error("extra data found")}}}(t,l);n=l<=8?new i(a*o*4):new Uint16Array(a*o*4);var p,d,_=Math.pow(2,l)-1,g=0;if(u)p=r.getImagePasses(a,o),d=r.getInterlaceIterator(a,o);else{var y=0;d=function(){var t=y;return y+=4,t},p=[{width:a,height:o}]}for(var m=0;m<p.length;m++)8===l?g=s(p[m],n,d,f,t,g):h(p[m],n,d,f,c,_);if(8===l){if(g!==t.length)throw new Error("extra data found")}else c.end();return n}},408178:function(t,e,n){var i=n(830816).Buffer,r=n(926835);t.exports=function(t,e,n,a){var o=-1!==[r.COLORTYPE_COLOR_ALPHA,r.COLORTYPE_ALPHA].indexOf(a.colorType);if(a.colorType===a.inputColorType){var s=function(){var t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256!==new Int16Array(t)[0]}();if(8===a.bitDepth||16===a.bitDepth&&s)return t}var h=16!==a.bitDepth?t:new Uint16Array(t.buffer),l=255,f=r.COLORTYPE_TO_BPP_MAP[a.inputColorType];4!==f||a.inputHasAlpha||(f=3);var u=r.COLORTYPE_TO_BPP_MAP[a.colorType];16===a.bitDepth&&(l=65535,u*=2);var c=new i(e*n*u),p=0,d=0,_=a.bgColor||{};function g(){var t,e,n,i=l;switch(a.inputColorType){case r.COLORTYPE_COLOR_ALPHA:i=h[p+3],t=h[p],e=h[p+1],n=h[p+2];break;case r.COLORTYPE_COLOR:t=h[p],e=h[p+1],n=h[p+2];break;case r.COLORTYPE_ALPHA:i=h[p+1],e=t=h[p],n=t;break;case r.COLORTYPE_GRAYSCALE:e=t=h[p],n=t;break;default:throw new Error("input color type:"+a.inputColorType+" is not supported at present")}return a.inputHasAlpha&&(o||(i/=l,t=Math.min(Math.max(Math.round((1-i)*_.red+i*t),0),l),e=Math.min(Math.max(Math.round((1-i)*_.green+i*e),0),l),n=Math.min(Math.max(Math.round((1-i)*_.blue+i*n),0),l))),{red:t,green:e,blue:n,alpha:i}}void 0===_.red&&(_.red=l),void 0===_.green&&(_.green=l),void 0===_.blue&&(_.blue=l);for(var y=0;y<n;y++)for(var m=0;m<e;m++){var v=g();switch(a.colorType){case r.COLORTYPE_COLOR_ALPHA:case r.COLORTYPE_COLOR:8===a.bitDepth?(c[d]=v.red,c[d+1]=v.green,c[d+2]=v.blue,o&&(c[d+3]=v.alpha)):(c.writeUInt16BE(v.red,d),c.writeUInt16BE(v.green,d+2),c.writeUInt16BE(v.blue,d+4),o&&c.writeUInt16BE(v.alpha,d+6));break;case r.COLORTYPE_ALPHA:case r.COLORTYPE_GRAYSCALE:var b=(v.red+v.green+v.blue)/3;8===a.bitDepth?(c[d]=b,o&&(c[d+1]=v.alpha)):(c.writeUInt16BE(b,d),o&&c.writeUInt16BE(v.alpha,d+2));break;default:throw new Error("unrecognised color Type "+a.colorType)}p+=f,d+=u}return c}},983979:function(t,e,n){var i=n(127061),r=n(830816).Buffer,a=n(971323),o=n(504957),s=t.exports=function(){o.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};a.inherits(s,o),s.prototype.read=function(t,e){this._reads.push({length:Math.abs(t),allowLess:t<0,func:e}),i.nextTick(function(){this._process(),this._paused&&this._reads.length>0&&(this._paused=!1,this.emit("drain"))}.bind(this))},s.prototype.write=function(t,e){return this.writable?(n=r.isBuffer(t)?t:new r(t,e||this._encoding),this._buffers.push(n),this._buffered+=n.length,this._process(),this._reads&&0===this._reads.length&&(this._paused=!0),this.writable&&!this._paused):(this.emit("error",new Error("Stream not writable")),!1);var n},s.prototype.end=function(t,e){t&&this.write(t,e),this.writable=!1,this._buffers&&(0===this._buffers.length?this._end():(this._buffers.push(null),this._process()))},s.prototype.destroySoon=s.prototype.end,s.prototype._end=function(){this._reads.length>0&&this.emit("error",new Error("Unexpected end of input")),this.destroy()},s.prototype.destroy=function(){this._buffers&&(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))},s.prototype._processReadAllowingLess=function(t){this._reads.shift();var e=this._buffers[0];e.length>t.length?(this._buffered-=t.length,this._buffers[0]=e.slice(t.length),t.func.call(this,e.slice(0,t.length))):(this._buffered-=e.length,this._buffers.shift(),t.func.call(this,e))},s.prototype._processRead=function(t){this._reads.shift();for(var e=0,n=0,i=new r(t.length);e<t.length;){var a=this._buffers[n++],o=Math.min(a.length,t.length-e);a.copy(i,e,0,o),e+=o,o!==a.length&&(this._buffers[--n]=a.slice(o))}n>0&&this._buffers.splice(0,n),this._buffered-=t.length,t.func.call(this,i)},s.prototype._process=function(){try{for(;this._buffered>0&&this._reads&&this._reads.length>0;){var t=this._reads[0];if(t.allowLess)this._processReadAllowingLess(t);else{if(!(this._buffered>=t.length))break;this._processRead(t)}}this._buffers&&!this.writable&&this._end()}catch(e){this.emit("error",e)}}},926835:function(t){t.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},614115:function(t){var e=[];!function(){for(var t=0;t<256;t++){for(var n=t,i=0;i<8;i++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}}();var n=t.exports=function(){this._crc=-1};n.prototype.write=function(t){for(var n=0;n<t.length;n++)this._crc=e[255&(this._crc^t[n])]^this._crc>>>8;return!0},n.prototype.crc32=function(){return-1^this._crc},n.crc32=function(t){for(var n=-1,i=0;i<t.length;i++)n=e[255&(n^t[i])]^n>>>8;return-1^n}},503854:function(t,e,n){var i=n(830816).Buffer,r=n(905023);var a={0:function(t,e,n,i,r){for(var a=0;a<n;a++)i[r+a]=t[e+a]},1:function(t,e,n,i,r,a){for(var o=0;o<n;o++){var s=o>=a?t[e+o-a]:0,h=t[e+o]-s;i[r+o]=h}},2:function(t,e,n,i,r){for(var a=0;a<n;a++){var o=e>0?t[e+a-n]:0,s=t[e+a]-o;i[r+a]=s}},3:function(t,e,n,i,r,a){for(var o=0;o<n;o++){var s=o>=a?t[e+o-a]:0,h=e>0?t[e+o-n]:0,l=t[e+o]-(s+h>>1);i[r+o]=l}},4:function(t,e,n,i,a,o){for(var s=0;s<n;s++){var h=s>=o?t[e+s-o]:0,l=e>0?t[e+s-n]:0,f=e>0&&s>=o?t[e+s-(n+o)]:0,u=t[e+s]-r(h,l,f);i[a+s]=u}}},o={0:function(t,e,n){for(var i=0,r=e+n,a=e;a<r;a++)i+=Math.abs(t[a]);return i},1:function(t,e,n,i){for(var r=0,a=0;a<n;a++){var o=a>=i?t[e+a-i]:0,s=t[e+a]-o;r+=Math.abs(s)}return r},2:function(t,e,n){for(var i=0,r=e+n,a=e;a<r;a++){var o=e>0?t[a-n]:0,s=t[a]-o;i+=Math.abs(s)}return i},3:function(t,e,n,i){for(var r=0,a=0;a<n;a++){var o=a>=i?t[e+a-i]:0,s=e>0?t[e+a-n]:0,h=t[e+a]-(o+s>>1);r+=Math.abs(h)}return r},4:function(t,e,n,i){for(var a=0,o=0;o<n;o++){var s=o>=i?t[e+o-i]:0,h=e>0?t[e+o-n]:0,l=e>0&&o>=i?t[e+o-(n+i)]:0,f=t[e+o]-r(s,h,l);a+=Math.abs(f)}return a}};t.exports=function(t,e,n,r,s){var h;if("filterType"in r&&-1!==r.filterType){if("number"!==typeof r.filterType)throw new Error("unrecognised filter types");h=[r.filterType]}else h=[0,1,2,3,4];16===r.bitDepth&&(s*=2);for(var l=e*s,f=0,u=0,c=new i((l+1)*n),p=h[0],d=0;d<n;d++){if(h.length>1)for(var _=1/0,g=0;g<h.length;g++){var y=o[h[g]](t,u,l,s);y<_&&(p=h[g],_=y)}c[f]=p,f++,a[p](t,u,l,c,f,s),f+=l,u+=l}return c}},327287:function(t,e,n){var i=n(830816).Buffer,r=n(971323),a=n(983979),o=n(947279),s=t.exports=function(t){a.call(this);var e=[],n=this;this._filter=new o(t,{read:this.read.bind(this),write:function(t){e.push(t)},complete:function(){n.emit("complete",i.concat(e))}}),this._filter.start()};r.inherits(s,a)},955032:function(t,e,n){var i=n(830816).Buffer,r=n(694029),a=n(947279);e.process=function(t,e){var n=[],o=new r(t);return new a(e,{read:o.read.bind(o),write:function(t){n.push(t)},complete:function(){}}).start(),o.process(),i.concat(n)}},947279:function(t,e,n){var i=n(830816).Buffer,r=n(452364),a=n(905023);function o(t,e,n){var i=t*e;return 8!==n&&(i=Math.ceil(i/(8/n))),i}var s=t.exports=function(t,e){var n=t.width,i=t.height,a=t.interlace,s=t.bpp,h=t.depth;if(this.read=e.read,this.write=e.write,this.complete=e.complete,this._imageIndex=0,this._images=[],a)for(var l=r.getImagePasses(n,i),f=0;f<l.length;f++)this._images.push({byteWidth:o(l[f].width,s,h),height:l[f].height,lineIndex:0});else this._images.push({byteWidth:o(n,s,h),height:i,lineIndex:0});this._xComparison=8===h?s:16===h?2*s:1};s.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},s.prototype._unFilterType1=function(t,e,n){for(var i=this._xComparison,r=i-1,a=0;a<n;a++){var o=t[1+a],s=a>r?e[a-i]:0;e[a]=o+s}},s.prototype._unFilterType2=function(t,e,n){for(var i=this._lastLine,r=0;r<n;r++){var a=t[1+r],o=i?i[r]:0;e[r]=a+o}},s.prototype._unFilterType3=function(t,e,n){for(var i=this._xComparison,r=i-1,a=this._lastLine,o=0;o<n;o++){var s=t[1+o],h=a?a[o]:0,l=o>r?e[o-i]:0,f=Math.floor((l+h)/2);e[o]=s+f}},s.prototype._unFilterType4=function(t,e,n){for(var i=this._xComparison,r=i-1,o=this._lastLine,s=0;s<n;s++){var h=t[1+s],l=o?o[s]:0,f=s>r?e[s-i]:0,u=s>r&&o?o[s-i]:0,c=a(f,l,u);e[s]=h+c}},s.prototype._reverseFilterLine=function(t){var e,n=t[0],r=this._images[this._imageIndex],a=r.byteWidth;if(0===n)e=t.slice(1,a+1);else switch(e=new i(a),n){case 1:this._unFilterType1(t,e,a);break;case 2:this._unFilterType2(t,e,a);break;case 3:this._unFilterType3(t,e,a);break;case 4:this._unFilterType4(t,e,a);break;default:throw new Error("Unrecognised filter type - "+n)}this.write(e),r.lineIndex++,r.lineIndex>=r.height?(this._lastLine=null,this._imageIndex++,r=this._images[this._imageIndex]):this._lastLine=e,r?this.read(r.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())}},404183:function(t,e,n){var i=n(830816).Buffer;t.exports=function(t,e){var n=e.depth,r=e.width,a=e.height,o=e.colorType,s=e.transColor,h=e.palette,l=t;return 3===o?function(t,e,n,i,r){for(var a=0,o=0;o<i;o++)for(var s=0;s<n;s++){var h=r[t[a]];if(!h)throw new Error("index "+t[a]+" not in palette");for(var l=0;l<4;l++)e[a+l]=h[l];a+=4}}(t,l,r,a,h):(s&&function(t,e,n,i,r){for(var a=0,o=0;o<i;o++)for(var s=0;s<n;s++){var h=!1;if(1===r.length?r[0]===t[a]&&(h=!0):r[0]===t[a]&&r[1]===t[a+1]&&r[2]===t[a+2]&&(h=!0),h)for(var l=0;l<4;l++)e[a+l]=0;a+=4}}(t,l,r,a,s),8!==n&&(16===n&&(l=new i(r*a*4)),function(t,e,n,i,r){for(var a=Math.pow(2,r)-1,o=0,s=0;s<i;s++)for(var h=0;h<n;h++){for(var l=0;l<4;l++)e[o+l]=Math.floor(255*t[o+l]/a+.5);o+=4}}(t,l,r,a,n))),l}},452364:function(t,e){var n=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];e.getImagePasses=function(t,e){for(var i=[],r=t%8,a=e%8,o=(t-r)/8,s=(e-a)/8,h=0;h<n.length;h++){for(var l=n[h],f=o*l.x.length,u=s*l.y.length,c=0;c<l.x.length&&l.x[c]<r;c++)f++;for(c=0;c<l.y.length&&l.y[c]<a;c++)u++;f>0&&u>0&&i.push({width:f,height:u,index:h})}return i},e.getInterlaceIterator=function(t){return function(e,i,r){var a=e%n[r].x.length,o=(e-a)/n[r].x.length*8+n[r].x[a],s=i%n[r].y.length;return 4*o+((i-s)/n[r].y.length*8+n[r].y[s])*t*4}}},993171:function(t,e,n){var i=n(830816).Buffer,r=n(971323),a=n(504957),o=n(926835),s=n(298700),h=t.exports=function(t){a.call(this);var e=t||{};this._packer=new s(e),this._deflate=this._packer.createDeflate(),this.readable=!0};r.inherits(h,a),h.prototype.pack=function(t,e,n,r){this.emit("data",new i(o.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(e,n)),r&&this.emit("data",this._packer.packGAMA(r));var a=this._packer.filterData(t,e,n);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",function(t){this.emit("data",this._packer.packIDAT(t))}.bind(this)),this._deflate.on("end",function(){this.emit("data",this._packer.packIEND()),this.emit("end")}.bind(this)),this._deflate.end(a)}},35576:function(t,e,n){var i=n(830816).Buffer,r=!0,a=n(546864);a.deflateSync||(r=!1);var o=n(926835),s=n(298700);t.exports=function(t,e){if(!r)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var n=new s(e||{}),h=[];h.push(new i(o.PNG_SIGNATURE)),h.push(n.packIHDR(t.width,t.height)),t.gamma&&h.push(n.packGAMA(t.gamma));var l=n.filterData(t.data,t.width,t.height),f=a.deflateSync(l,n.getDeflateOptions());if(l=null,!f||!f.length)throw new Error("bad png - invalid compressed data response");return h.push(n.packIDAT(f)),h.push(n.packIEND()),i.concat(h)}},298700:function(t,e,n){var i=n(830816).Buffer,r=n(926835),a=n(614115),o=n(408178),s=n(503854),h=n(546864),l=t.exports=function(t){if(this._options=t,t.deflateChunkSize=t.deflateChunkSize||32768,t.deflateLevel=null!=t.deflateLevel?t.deflateLevel:9,t.deflateStrategy=null!=t.deflateStrategy?t.deflateStrategy:3,t.inputHasAlpha=null==t.inputHasAlpha||t.inputHasAlpha,t.deflateFactory=t.deflateFactory||h.createDeflate,t.bitDepth=t.bitDepth||8,t.colorType="number"===typeof t.colorType?t.colorType:r.COLORTYPE_COLOR_ALPHA,t.inputColorType="number"===typeof t.inputColorType?t.inputColorType:r.COLORTYPE_COLOR_ALPHA,-1===[r.COLORTYPE_GRAYSCALE,r.COLORTYPE_COLOR,r.COLORTYPE_COLOR_ALPHA,r.COLORTYPE_ALPHA].indexOf(t.colorType))throw new Error("option color type:"+t.colorType+" is not supported at present");if(-1===[r.COLORTYPE_GRAYSCALE,r.COLORTYPE_COLOR,r.COLORTYPE_COLOR_ALPHA,r.COLORTYPE_ALPHA].indexOf(t.inputColorType))throw new Error("option input color type:"+t.inputColorType+" is not supported at present");if(8!==t.bitDepth&&16!==t.bitDepth)throw new Error("option bit depth:"+t.bitDepth+" is not supported at present")};l.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},l.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},l.prototype.filterData=function(t,e,n){var i=o(t,e,n,this._options),a=r.COLORTYPE_TO_BPP_MAP[this._options.colorType];return s(i,e,n,this._options,a)},l.prototype._packChunk=function(t,e){var n=e?e.length:0,r=new i(n+12);return r.writeUInt32BE(n,0),r.writeUInt32BE(t,4),e&&e.copy(r,8),r.writeInt32BE(a.crc32(r.slice(4,r.length-4)),r.length-4),r},l.prototype.packGAMA=function(t){var e=new i(4);return e.writeUInt32BE(Math.floor(t*r.GAMMA_DIVISION),0),this._packChunk(r.TYPE_gAMA,e)},l.prototype.packIHDR=function(t,e){var n=new i(13);return n.writeUInt32BE(t,0),n.writeUInt32BE(e,4),n[8]=this._options.bitDepth,n[9]=this._options.colorType,n[10]=0,n[11]=0,n[12]=0,this._packChunk(r.TYPE_IHDR,n)},l.prototype.packIDAT=function(t){return this._packChunk(r.TYPE_IDAT,t)},l.prototype.packIEND=function(){return this._packChunk(r.TYPE_IEND,null)}},905023:function(t){t.exports=function(t,e,n){var i=t+e-n,r=Math.abs(i-t),a=Math.abs(i-e),o=Math.abs(i-n);return r<=a&&r<=o?t:a<=o?e:n}},874409:function(t,e,n){var i=n(971323),r=n(546864),a=n(983979),o=n(327287),s=n(229713),h=n(610648),l=n(404183),f=t.exports=function(t){a.call(this),this._parser=new s(t,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this),simpleTransparency:this._simpleTransparency.bind(this),headersFinished:this._headersFinished.bind(this)}),this._options=t,this.writable=!0,this._parser.start()};i.inherits(f,a),f.prototype._handleError=function(t){this.emit("error",t),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",(function(){}))),this.errord=!0},f.prototype._inflateData=function(t){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=r.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{var e=(1+(this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3))*this._bitmapInfo.height,n=Math.max(e,r.Z_MIN_CHUNK);this._inflate=r.createInflate({chunkSize:n});var i=e,a=this.emit.bind(this,"error");this._inflate.on("error",(function(t){i&&a(t)})),this._filter.on("complete",this._complete.bind(this));var o=this._filter.write.bind(this._filter);this._inflate.on("data",(function(t){i&&(t.length>i&&(t=t.slice(0,i)),i-=t.length,o(t))})),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(t)},f.prototype._handleMetaData=function(t){this._metaData=t,this._bitmapInfo=Object.create(t),this._filter=new o(this._bitmapInfo)},f.prototype._handleTransColor=function(t){this._bitmapInfo.transColor=t},f.prototype._handlePalette=function(t){this._bitmapInfo.palette=t},f.prototype._simpleTransparency=function(){this._metaData.alpha=!0},f.prototype._headersFinished=function(){this.emit("metadata",this._metaData)},f.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"),this.destroySoon())},f.prototype._complete=function(t){if(!this.errord){try{var e=h.dataToBitMap(t,this._bitmapInfo),n=l(e,this._bitmapInfo);e=null}catch(i){return void this._handleError(i)}this.emit("parsed",n)}}},873259:function(t,e,n){var i=n(830816).Buffer,r=!0,a=n(546864),o=n(368621);a.deflateSync||(r=!1);var s=n(694029),h=n(955032),l=n(229713),f=n(610648),u=n(404183);t.exports=function(t,e){if(!r)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var n,c,p;var d=[];var _=new s(t),g=new l(e,{read:_.read.bind(_),error:function(t){n=t},metadata:function(t){c=t},gamma:function(t){p=t},palette:function(t){c.palette=t},transColor:function(t){c.transColor=t},inflateData:function(t){d.push(t)},simpleTransparency:function(){c.alpha=!0}});if(g.start(),_.process(),n)throw n;var y,m=i.concat(d);if(d.length=0,c.interlace)y=a.inflateSync(m);else{var v=(1+(c.width*c.bpp*c.depth+7>>3))*c.height;y=o(m,{chunkSize:v,maxLength:v})}if(m=null,!y||!y.length)throw new Error("bad png - invalid inflate data response");var b=h.process(y,c);m=null;var w=f.dataToBitMap(b,c);b=null;var k=u(w,c);return c.data=k,c.gamma=p||0,c}},229713:function(t,e,n){var i=n(830816).Buffer,r=n(926835),a=n(614115),o=t.exports=function(t,e){this._options=t,t.checkCRC=!1!==t.checkCRC,this._hasIHDR=!1,this._hasIEND=!1,this._emittedHeadersFinished=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[r.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[r.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[r.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[r.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[r.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[r.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=e.read,this.error=e.error,this.metadata=e.metadata,this.gamma=e.gamma,this.transColor=e.transColor,this.palette=e.palette,this.parsed=e.parsed,this.inflateData=e.inflateData,this.finished=e.finished,this.simpleTransparency=e.simpleTransparency,this.headersFinished=e.headersFinished||function(){}};o.prototype.start=function(){this.read(r.PNG_SIGNATURE.length,this._parseSignature.bind(this))},o.prototype._parseSignature=function(t){for(var e=r.PNG_SIGNATURE,n=0;n<e.length;n++)if(t[n]!==e[n])return void this.error(new Error("Invalid file signature"));this.read(8,this._parseChunkBegin.bind(this))},o.prototype._parseChunkBegin=function(t){for(var e=t.readUInt32BE(0),n=t.readUInt32BE(4),o="",s=4;s<8;s++)o+=String.fromCharCode(t[s]);var h=Boolean(32&t[4]);if(this._hasIHDR||n===r.TYPE_IHDR){if(this._crc=new a,this._crc.write(new i(o)),this._chunks[n])return this._chunks[n](e);h?this.read(e+4,this._skipChunk.bind(this)):this.error(new Error("Unsupported critical chunk type "+o))}else this.error(new Error("Expected IHDR on beggining"))},o.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},o.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},o.prototype._parseChunkEnd=function(t){var e=t.readInt32BE(0),n=this._crc.crc32();this._options.checkCRC&&n!==e?this.error(new Error("Crc error - "+e+" - "+n)):this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},o.prototype._handleIHDR=function(t){this.read(t,this._parseIHDR.bind(this))},o.prototype._parseIHDR=function(t){this._crc.write(t);var e=t.readUInt32BE(0),n=t.readUInt32BE(4),i=t[8],a=t[9],o=t[10],s=t[11],h=t[12];if(8===i||4===i||2===i||1===i||16===i)if(a in r.COLORTYPE_TO_BPP_MAP)if(0===o)if(0===s)if(0===h||1===h){this._colorType=a;var l=r.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=!0,this.metadata({width:e,height:n,depth:i,interlace:Boolean(h),palette:Boolean(a&r.COLORTYPE_PALETTE),color:Boolean(a&r.COLORTYPE_COLOR),alpha:Boolean(a&r.COLORTYPE_ALPHA),bpp:l,colorType:a}),this._handleChunkEnd()}else this.error(new Error("Unsupported interlace method"));else this.error(new Error("Unsupported filter method"));else this.error(new Error("Unsupported compression method"));else this.error(new Error("Unsupported color type"));else this.error(new Error("Unsupported bit depth "+i))},o.prototype._handlePLTE=function(t){this.read(t,this._parsePLTE.bind(this))},o.prototype._parsePLTE=function(t){this._crc.write(t);for(var e=Math.floor(t.length/3),n=0;n<e;n++)this._palette.push([t[3*n],t[3*n+1],t[3*n+2],255]);this.palette(this._palette),this._handleChunkEnd()},o.prototype._handleTRNS=function(t){this.simpleTransparency(),this.read(t,this._parseTRNS.bind(this))},o.prototype._parseTRNS=function(t){if(this._crc.write(t),this._colorType===r.COLORTYPE_PALETTE_COLOR){if(0===this._palette.length)return void this.error(new Error("Transparency chunk must be after palette"));if(t.length>this._palette.length)return void this.error(new Error("More transparent colors than palette size"));for(var e=0;e<t.length;e++)this._palette[e][3]=t[e];this.palette(this._palette)}this._colorType===r.COLORTYPE_GRAYSCALE&&this.transColor([t.readUInt16BE(0)]),this._colorType===r.COLORTYPE_COLOR&&this.transColor([t.readUInt16BE(0),t.readUInt16BE(2),t.readUInt16BE(4)]),this._handleChunkEnd()},o.prototype._handleGAMA=function(t){this.read(t,this._parseGAMA.bind(this))},o.prototype._parseGAMA=function(t){this._crc.write(t),this.gamma(t.readUInt32BE(0)/r.GAMMA_DIVISION),this._handleChunkEnd()},o.prototype._handleIDAT=function(t){this._emittedHeadersFinished||(this._emittedHeadersFinished=!0,this.headersFinished()),this.read(-t,this._parseIDAT.bind(this,t))},o.prototype._parseIDAT=function(t,e){if(this._crc.write(e),this._colorType===r.COLORTYPE_PALETTE_COLOR&&0===this._palette.length)throw new Error("Expected palette not found");this.inflateData(e);var n=t-e.length;n>0?this._handleIDAT(n):this._handleChunkEnd()},o.prototype._handleIEND=function(t){this.read(t,this._parseIEND.bind(this))},o.prototype._parseIEND=function(t){this._crc.write(t),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()}},614083:function(t,e,n){var i=n(873259),r=n(35576);e.read=function(t,e){return i(t,e||{})},e.write=function(t,e){return r(t,e)}},139788:function(t,e,n){var i=n(830816).Buffer,r=n(127061),a=n(971323),o=n(504957),s=n(874409),h=n(993171),l=n(614083),f=e.PNG=function(t){o.call(this),t=t||{},this.width=0|t.width,this.height=0|t.height,this.data=this.width>0&&this.height>0?new i(4*this.width*this.height):null,t.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new s(t),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",function(t){this.data=t,this.emit("parsed",t)}.bind(this)),this._packer=new h(t),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};a.inherits(f,o),f.sync=l,f.prototype.pack=function(){return this.data&&this.data.length?(r.nextTick(function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}.bind(this)),this):(this.emit("error","No data provided"),this)},f.prototype.parse=function(t,e){var n,i;e&&(n=function(t){this.removeListener("error",i),this.data=t,e(null,this)}.bind(this),i=function(t){this.removeListener("parsed",n),e(t,null)}.bind(this),this.once("parsed",n),this.once("error",i));return this.end(t),this},f.prototype.write=function(t){return this._parser.write(t),!0},f.prototype.end=function(t){this._parser.end(t)},f.prototype._metadata=function(t){this.width=t.width,this.height=t.height,this.emit("metadata",t)},f.prototype._gamma=function(t){this.gamma=t},f.prototype._handleClose=function(){this._parser.writable||this._packer.readable||this.emit("close")},f.bitblt=function(t,e,n,i,r,a,o,s){if(i|=0,r|=0,a|=0,o|=0,s|=0,(n|=0)>t.width||i>t.height||n+r>t.width||i+a>t.height)throw new Error("bitblt reading outside image");if(o>e.width||s>e.height||o+r>e.width||s+a>e.height)throw new Error("bitblt writing outside image");for(var h=0;h<a;h++)t.data.copy(e.data,(s+h)*e.width+o<<2,(i+h)*t.width+n<<2,(i+h)*t.width+n+r<<2)},f.prototype.bitblt=function(t,e,n,i,r,a,o){return f.bitblt(this,t,e,n,i,r,a,o),this},f.adjustGamma=function(t){if(t.gamma){for(var e=0;e<t.height;e++)for(var n=0;n<t.width;n++)for(var i=t.width*e+n<<2,r=0;r<3;r++){var a=t.data[i+r]/255;a=Math.pow(a,1/2.2/t.gamma),t.data[i+r]=Math.round(255*a)}t.gamma=0}},f.prototype.adjustGamma=function(){f.adjustGamma(this)}},368621:function(t,e,n){var i=n(127061),r=n(830816).Buffer,a=n(939619).ok,o=n(546864),s=n(971323),h=n(830816).kMaxLength;function l(t){if(!(this instanceof l))return new l(t);t&&t.chunkSize<o.Z_MIN_CHUNK&&(t.chunkSize=o.Z_MIN_CHUNK),o.Inflate.call(this,t),this._offset=void 0===this._offset?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,t&&null!=t.maxLength&&(this._maxLength=t.maxLength)}function f(t,e){e&&i.nextTick(e),t._handle&&(t._handle.close(),t._handle=null)}function u(t,e){return function(t,e){if("string"===typeof e&&(e=r.from(e)),!(e instanceof r))throw new TypeError("Not a string or buffer");var n=t._finishFlushFlag;return null==n&&(n=o.Z_FINISH),t._processChunk(e,n)}(new l(e),t)}l.prototype._processChunk=function(t,e,n){if("function"===typeof n)return o.Inflate._processChunk.call(this,t,e,n);var i,s=this,l=t&&t.length,u=this._chunkSize-this._offset,c=this._maxLength,p=0,d=[],_=0;function g(t,e){if(!s._hadError){var n=u-e;if(a(n>=0,"have should not go down"),n>0){var i=s._buffer.slice(s._offset,s._offset+n);if(s._offset+=n,i.length>c&&(i=i.slice(0,c)),d.push(i),_+=i.length,0===(c-=i.length))return!1}return(0===e||s._offset>=s._chunkSize)&&(u=s._chunkSize,s._offset=0,s._buffer=r.allocUnsafe(s._chunkSize)),0===e&&(p+=l-t,l=t,!0)}}this.on("error",(function(t){i=t})),a(this._handle,"zlib binding closed");do{var y=this._handle.writeSync(e,t,p,l,this._buffer,this._offset,u);y=y||this._writeState}while(!this._hadError&&g(y[0],y[1]));if(this._hadError)throw i;if(_>=h)throw f(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+h.toString(16)+" bytes");var m=r.concat(d,_);return f(this),m},s.inherits(l,o.Inflate),t.exports=e=u,e.Inflate=l,e.createInflate=function(t){return new l(t)},e.inflateSync=u},694029:function(t){var e=t.exports=function(t){this._buffer=t,this._reads=[]};e.prototype.read=function(t,e){this._reads.push({length:Math.abs(t),allowLess:t<0,func:e})},e.prototype.process=function(){for(;this._reads.length>0&&this._buffer.length;){var t=this._reads[0];if(!this._buffer.length||!(this._buffer.length>=t.length||t.allowLess))break;this._reads.shift();var e=this._buffer;this._buffer=e.slice(t.length),t.func.call(this,e.slice(0,t.length))}return this._reads.length>0?new Error("There are some read requests waitng on finished stream"):this._buffer.length>0?new Error("unrecognised content at end of stream"):void 0}}}]);